yarn run v1.22.22
$ jest
 PASS   service  src/service/repositories/ListingRepositoryFallback.test.ts
  ‚óè Console
    console.log
      Attempting generation with model: gemini-3-pro-image-preview
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: undefined,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'gemini-3-pro-image-preview',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      Model gemini-3-pro-image-preview failed with retryable error. Trying next model...
      at Object.generateImages (src/service/repositories/ListingRepository.ts:57:19)
    console.log
      Attempting generation with model: imagen-4.0-generate-001
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: undefined,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'imagen-4.0-generate-001',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      Attempting generation with model: gemini-3-pro-image-preview
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: undefined,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'gemini-3-pro-image-preview',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      Model gemini-3-pro-image-preview failed with retryable error. Trying next model...
      at Object.generateImages (src/service/repositories/ListingRepository.ts:57:19)
    console.log
      Attempting generation with model: imagen-4.0-generate-001
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: undefined,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'imagen-4.0-generate-001',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      Model imagen-4.0-generate-001 failed with retryable error. Trying next model...
      at Object.generateImages (src/service/repositories/ListingRepository.ts:57:19)
    console.log
      Attempting generation with model: gpt-image-1.5
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: undefined,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'gpt-image-1.5',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      Attempting generation with model: gemini-3-pro-image-preview
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: undefined,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'gemini-3-pro-image-preview',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      Model gemini-3-pro-image-preview failed with retryable error. Trying next model...
      at Object.generateImages (src/service/repositories/ListingRepository.ts:57:19)
    console.log
      Attempting generation with model: imagen-4.0-generate-001
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: undefined,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'imagen-4.0-generate-001',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      Model imagen-4.0-generate-001 failed with retryable error. Trying next model...
      at Object.generateImages (src/service/repositories/ListingRepository.ts:57:19)
    console.log
      Attempting generation with model: gpt-image-1.5
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: undefined,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'gpt-image-1.5',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      Attempting generation with model: gemini-3-pro-image-preview
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: undefined,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'gemini-3-pro-image-preview',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      Model gemini-3-pro-image-preview failed with retryable error. Trying next model...
      at Object.generateImages (src/service/repositories/ListingRepository.ts:57:19)
    console.log
      Attempting generation with model: imagen-4.0-generate-001
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: undefined,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'imagen-4.0-generate-001',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
 PASS   service  src/service/data/GeminiImageGeneratorExtraction.test.ts
 PASS   service  src/service/repositories/ListingRepository.test.ts
  ‚óè Console
    console.log
      [dotenv@17.2.3] injecting env (1) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
      at _log (node_modules/dotenv/lib/main.js:142:11)
    console.log
      Attempting generation with model: gemini-3-pro-image-preview
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: 1,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'gemini-3-pro-image-preview',
        hasProductImage: true
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      Attempting generation with model: gemini-3-pro-image-preview
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 0,
        hero: 0,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'gemini-3-pro-image-preview',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
 PASS   service  src/service/test/integration/GenerateListingImagesError.test.ts
  ‚óè Console
    console.log
      [dotenv@17.2.3] injecting env (1) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
      at _log (node_modules/dotenv/lib/main.js:142:11)
    console.log
      Incoming request: POST /listings/generate
      at src/service/app.ts:17:11
    console.log
      Attempting generation with model: gemini-3-pro-image-preview
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 0,
        hero: 0,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'gemini-3-pro-image-preview',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      POST /listings/generate - 200 - 37ms
      at src/service/app.ts:20:11
 PASS   service  src/service/test/integration/PromptPreview.test.ts
  ‚óè Console
    console.log
      [dotenv@17.2.3] injecting env (1) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
      at _log (node_modules/dotenv/lib/main.js:142:11)
    console.log
      Incoming request: POST /listings/system-prompt
      at src/service/app.ts:17:11
    console.log
      POST /listings/system-prompt - 200 - 36ms
      at src/service/app.ts:20:11
    console.log
      Incoming request: POST /listings/system-prompt
      at src/service/app.ts:17:11
    console.log
      POST /listings/system-prompt - 200 - 0ms
      at src/service/app.ts:20:11
    console.log
      Incoming request: POST /listings/system-prompt
      at src/service/app.ts:17:11
    console.log
      POST /listings/system-prompt - 200 - 1ms
      at src/service/app.ts:20:11
    console.log
      Incoming request: GET /listings/system-prompt
      at src/service/app.ts:17:11
    console.log
      GET /listings/system-prompt - 405 - 0ms
      at src/service/app.ts:20:11
 PASS   client  src/client/hooks/useListingGeneration.test.ts
  ‚óè Console
    console.log
      Generation failed for model: gemini-3-pro-image-preview Server Error (503): Service Unavailable
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:74:17)
    console.log
      Generation failed for model: gemini-3-pro-image-preview Something went wrong
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:74:17)
    console.log
      Generation failed for model: gemini-3-pro-image-preview Something went wrong
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:74:17)
    console.log
      Generation failed for model: gemini-3-pro-image-preview 503 Service Unavailable
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:74:17)
    console.log
      Generation failed for model: gemini-3-pro-image-preview Internal Server Error
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:74:17)
 PASS   client  src/client/test/ListingGenerationUI.test.tsx
 PASS   client  src/client/test/ProductUpload.test.tsx
  ‚óè Console
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at flushPendingEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18358:14)
          at flushSpawnedWork (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18323:44)
          at commitRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17955:9)
          at performWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16667:15)
          at performSyncWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18972:7)
          at flushSyncWorkAcrossRoots_impl (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18814:21)
          at flushSyncWork$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16898:12)
          at batchedUpdates$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:3263:14)
          at dispatchEventForPluginEventSystem (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:19320:7)
          at dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23585:11)
          at dispatchDiscreteEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23553:11)
          at HTMLDivElement.callTheUserObjectsOperation (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
          at innerInvokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
          at invokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
          at HTMLInputElementImpl._dispatch (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
          at HTMLInputElementImpl.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
          at HTMLInputElement.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:19:20
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:107:16
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:47:24
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:814:22)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at Object.eventWrapper (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:106:28)
          at fireEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:12:35)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:110:36)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/fire-event.js:15:52)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:36:15)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at flushPendingEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18358:14)
          at flushSpawnedWork (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18323:44)
          at commitRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17955:9)
          at performWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16667:15)
          at performSyncWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18972:7)
          at flushSyncWorkAcrossRoots_impl (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18814:21)
          at flushSyncWork$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16898:12)
          at batchedUpdates$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:3263:14)
          at dispatchEventForPluginEventSystem (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:19320:7)
          at dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23585:11)
          at dispatchDiscreteEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23553:11)
          at HTMLDivElement.callTheUserObjectsOperation (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
          at innerInvokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
          at invokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
          at HTMLInputElementImpl._dispatch (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
          at HTMLInputElementImpl.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
          at HTMLInputElement.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:19:20
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:107:16
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:47:24
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:814:22)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at Object.eventWrapper (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:106:28)
          at fireEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:12:35)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:110:36)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/fire-event.js:15:52)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:43:15)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at flushPendingEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18358:14)
          at flushSpawnedWork (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18323:44)
          at commitRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17955:9)
          at performWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16667:15)
          at performSyncWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18972:7)
          at flushSyncWorkAcrossRoots_impl (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18814:21)
          at flushSyncWork$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16898:12)
          at batchedUpdates$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:3263:14)
          at dispatchEventForPluginEventSystem (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:19320:7)
          at dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23585:11)
          at dispatchDiscreteEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23553:11)
          at HTMLDivElement.callTheUserObjectsOperation (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
          at innerInvokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
          at invokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
          at HTMLInputElementImpl._dispatch (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
          at HTMLInputElementImpl.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
          at HTMLInputElement.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:19:20
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:107:16
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:47:24
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:814:22)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at Object.eventWrapper (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:106:28)
          at fireEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:12:35)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:110:36)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/fire-event.js:15:52)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:50:15)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at flushPendingEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18358:14)
          at flushSpawnedWork (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18323:44)
          at commitRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17955:9)
          at performWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16667:15)
          at performSyncWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18972:7)
          at flushSyncWorkAcrossRoots_impl (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18814:21)
          at flushSyncWork$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16898:12)
          at batchedUpdates$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:3263:14)
          at dispatchEventForPluginEventSystem (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:19320:7)
          at dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23585:11)
          at dispatchDiscreteEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23553:11)
          at HTMLDivElement.callTheUserObjectsOperation (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
          at innerInvokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
          at invokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
          at HTMLInputElementImpl._dispatch (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
          at HTMLInputElementImpl.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
          at HTMLInputElement.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:19:20
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:107:16
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:47:24
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:814:22)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at Object.eventWrapper (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:106:28)
          at fireEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:12:35)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:110:36)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/fire-event.js:15:52)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:57:15)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at flushPendingEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18358:14)
          at flushSpawnedWork (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18323:44)
          at commitRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17955:9)
          at performWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16667:15)
          at performSyncWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18972:7)
          at flushSyncWorkAcrossRoots_impl (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18814:21)
          at flushSyncWork$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16898:12)
          at batchedUpdates$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:3263:14)
          at dispatchEventForPluginEventSystem (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:19320:7)
          at dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23585:11)
          at dispatchDiscreteEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23553:11)
          at HTMLDivElement.callTheUserObjectsOperation (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
          at innerInvokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
          at invokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
          at HTMLInputElementImpl._dispatch (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
          at HTMLInputElementImpl.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
          at HTMLInputElement.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:19:20
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:107:16
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:47:24
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:814:22)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at Object.eventWrapper (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:106:28)
          at fireEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:12:35)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:110:36)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/fire-event.js:15:52)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:64:15)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at flushPendingEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18358:14)
          at flushSpawnedWork (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18323:44)
          at commitRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17955:9)
          at performWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16667:15)
          at performSyncWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18972:7)
          at flushSyncWorkAcrossRoots_impl (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18814:21)
          at flushSyncWork$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16898:12)
          at batchedUpdates$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:3263:14)
          at dispatchEventForPluginEventSystem (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:19320:7)
          at dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23585:11)
          at dispatchDiscreteEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23553:11)
          at HTMLDivElement.callTheUserObjectsOperation (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
          at innerInvokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
          at invokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
          at HTMLInputElementImpl._dispatch (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
          at HTMLInputElementImpl.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
          at HTMLInputElement.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:19:20
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:107:16
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:47:24
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:814:22)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at Object.eventWrapper (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:106:28)
          at fireEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:12:35)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:110:36)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/fire-event.js:15:52)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:71:15)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:70:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:154:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:80:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      155 |         setSystemPrompt(response.systemPrompt || '');
      156 |       } catch (err) {
    > 157 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      158 |       }
      159 |     }, [listingRepository])
      160 |   };
      at src/client/hooks/useListingGeneration.ts:157:17
 PASS   service  src/service/test/integration/GeminiImageGenerator.test.ts (27.637 s)
  ‚óè Console
    console.log
      [dotenv@17.2.3] injecting env (1) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
      at _log (node_modules/dotenv/lib/main.js:142:11)
    console.log
      Incoming request: POST /listings/generate
      at src/service/app.ts:17:11
    console.log
      Attempting generation with model: gemini-3-pro-image-preview
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: 0,
        closeUps: 0,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'gemini-3-pro-image-preview',
        hasProductImage: true
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      POST /listings/generate - 200 - 25930ms
      at src/service/app.ts:20:11
 PASS   service  src/service/commands/GenerateListingImages.test.ts (42.624 s)
  ‚óè Console
    console.log
      [dotenv@17.2.3] injecting env (1) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
      at _log (node_modules/dotenv/lib/main.js:142:11)
    console.log
      Attempting generation with model: gemini-3-pro-image-preview
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: undefined,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'gemini-3-pro-image-preview',
        hasProductImage: true
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
    console.log
      Attempting generation with model: gemini-3-pro-image-preview
      at Object.generateImages (src/service/repositories/ListingRepository.ts:43:17)
    console.log
      Generating images with params: {
        lifestyle: undefined,
        hero: undefined,
        closeUps: 1,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        model: 'gemini-3-pro-image-preview',
        hasProductImage: true
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:122:13)
 PASS   service  src/service/data/GeminiImageGenerator.test.ts (51.342 s)
  ‚óè Console
    console.log
      [dotenv@17.2.3] injecting env (1) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
      at _log (node_modules/dotenv/lib/main.js:142:11)
A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Test Suites: 11 passed, 11 total
Tests:       57 passed, 57 total
Snapshots:   0 total
Time:        53.264 s, estimated 56 s
Ran all test suites in 2 projects.
‚ú®  Done in 53.97s.
