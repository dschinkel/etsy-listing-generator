yarn run v1.22.22
$ /Users/zevia/code/ai/etsy-listing-generator/node_modules/.bin/jest src/client/test/ProductUpload.test.tsx src/client/hooks/useListingGeneration.test.ts
 PASS   client  src/client/hooks/useListingGeneration.test.ts
  ● Console
    console.log
      Generation failed for model: gemini-3-pro-image-preview Server Error (503): Service Unavailable
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:74:17)
    console.log
      Generation failed for model: gemini-3-pro-image-preview Something went wrong
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:74:17)
    console.log
      Generation failed for model: gemini-3-pro-image-preview Something went wrong
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:74:17)
    console.log
      Generation failed for model: gemini-3-pro-image-preview 503 Service Unavailable
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:74:17)
    console.log
      Generation failed for model: gemini-3-pro-image-preview Internal Server Error
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:74:17)
 PASS   client  src/client/test/ProductUpload.test.tsx
  ● Console
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at processTicksAndRejections (node:internal/process/task_queues:105:5)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at flushPendingEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18358:14)
          at flushSpawnedWork (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18323:44)
          at commitRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17955:9)
          at performWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16667:15)
          at performSyncWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18972:7)
          at flushSyncWorkAcrossRoots_impl (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18814:21)
          at flushSyncWork$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16898:12)
          at batchedUpdates$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:3263:14)
          at dispatchEventForPluginEventSystem (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:19320:7)
          at dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23585:11)
          at dispatchDiscreteEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23553:11)
          at HTMLDivElement.callTheUserObjectsOperation (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
          at innerInvokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
          at invokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
          at HTMLInputElementImpl._dispatch (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
          at HTMLInputElementImpl.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
          at HTMLInputElement.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:19:20
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:107:16
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:47:24
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:814:22)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at Object.eventWrapper (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:106:28)
          at fireEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:12:35)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:110:36)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/fire-event.js:15:52)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:36:15)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at flushPendingEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18358:14)
          at flushSpawnedWork (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18323:44)
          at commitRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17955:9)
          at performWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16667:15)
          at performSyncWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18972:7)
          at flushSyncWorkAcrossRoots_impl (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18814:21)
          at flushSyncWork$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16898:12)
          at batchedUpdates$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:3263:14)
          at dispatchEventForPluginEventSystem (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:19320:7)
          at dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23585:11)
          at dispatchDiscreteEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23553:11)
          at HTMLDivElement.callTheUserObjectsOperation (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
          at innerInvokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
          at invokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
          at HTMLInputElementImpl._dispatch (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
          at HTMLInputElementImpl.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
          at HTMLInputElement.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:19:20
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:107:16
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:47:24
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:814:22)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at Object.eventWrapper (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:106:28)
          at fireEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:12:35)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:110:36)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/fire-event.js:15:52)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:43:15)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at flushPendingEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18358:14)
          at flushSpawnedWork (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18323:44)
          at commitRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17955:9)
          at performWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16667:15)
          at performSyncWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18972:7)
          at flushSyncWorkAcrossRoots_impl (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18814:21)
          at flushSyncWork$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16898:12)
          at batchedUpdates$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:3263:14)
          at dispatchEventForPluginEventSystem (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:19320:7)
          at dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23585:11)
          at dispatchDiscreteEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23553:11)
          at HTMLDivElement.callTheUserObjectsOperation (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
          at innerInvokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
          at invokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
          at HTMLInputElementImpl._dispatch (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
          at HTMLInputElementImpl.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
          at HTMLInputElement.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:19:20
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:107:16
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:47:24
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:814:22)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at Object.eventWrapper (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:106:28)
          at fireEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:12:35)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:110:36)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/fire-event.js:15:52)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:50:15)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at flushPendingEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18358:14)
          at flushSpawnedWork (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18323:44)
          at commitRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17955:9)
          at performWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16667:15)
          at performSyncWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18972:7)
          at flushSyncWorkAcrossRoots_impl (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18814:21)
          at flushSyncWork$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16898:12)
          at batchedUpdates$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:3263:14)
          at dispatchEventForPluginEventSystem (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:19320:7)
          at dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23585:11)
          at dispatchDiscreteEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23553:11)
          at HTMLDivElement.callTheUserObjectsOperation (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
          at innerInvokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
          at invokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
          at HTMLInputElementImpl._dispatch (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
          at HTMLInputElementImpl.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
          at HTMLInputElement.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:19:20
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:107:16
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:47:24
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:814:22)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at Object.eventWrapper (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:106:28)
          at fireEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:12:35)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:110:36)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/fire-event.js:15:52)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:57:15)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at flushPendingEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18358:14)
          at flushSpawnedWork (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18323:44)
          at commitRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17955:9)
          at performWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16667:15)
          at performSyncWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18972:7)
          at flushSyncWorkAcrossRoots_impl (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18814:21)
          at flushSyncWork$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16898:12)
          at batchedUpdates$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:3263:14)
          at dispatchEventForPluginEventSystem (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:19320:7)
          at dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23585:11)
          at dispatchDiscreteEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23553:11)
          at HTMLDivElement.callTheUserObjectsOperation (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
          at innerInvokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
          at invokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
          at HTMLInputElementImpl._dispatch (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
          at HTMLInputElementImpl.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
          at HTMLInputElement.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:19:20
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:107:16
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:47:24
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:814:22)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at Object.eventWrapper (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:106:28)
          at fireEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:12:35)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:110:36)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/fire-event.js:15:52)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:64:15)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at flushPendingEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18358:14)
          at flushSpawnedWork (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18323:44)
          at commitRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17955:9)
          at performWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16667:15)
          at performSyncWorkOnRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18972:7)
          at flushSyncWorkAcrossRoots_impl (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18814:21)
          at flushSyncWork$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:16898:12)
          at batchedUpdates$1 (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:3263:14)
          at dispatchEventForPluginEventSystem (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:19320:7)
          at dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23585:11)
          at dispatchDiscreteEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:23553:11)
          at HTMLDivElement.callTheUserObjectsOperation (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventListener.js:26:30)
          at innerInvokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:350:25)
          at invokeEventListeners (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:286:3)
          at HTMLInputElementImpl._dispatch (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:233:9)
          at HTMLInputElementImpl.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:104:17)
          at HTMLInputElement.dispatchEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:241:34)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:19:20
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:107:16
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:47:24
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:814:22)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at Object.eventWrapper (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:106:28)
          at fireEvent (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:12:35)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/dom/dist/events.js:110:36)
          at Function.fireEvent.<computed> [as change] (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/fire-event.js:15:52)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:71:15)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:316:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:252:3)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
    console.error
      Failed to fetch prompt preview: ReferenceError: fetch is not defined
          at fetchWithTimeout (/Users/zevia/code/ai/etsy-listing-generator/src/client/lib/utils.ts:17:22)
          at Object.getSystemPromptPreview (/Users/zevia/code/ai/etsy-listing-generator/src/client/repositories/ListingRepository.ts:77:44)
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/hooks/useListingGeneration.ts:151:50
          at /Users/zevia/code/ai/etsy-listing-generator/src/client/App.tsx:81:5
          at Object.react_stack_bottom_frame (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:590:34)
          at Object.<anonymous>.process.env.NODE_ENV.exports.act (/Users/zevia/code/ai/etsy-listing-generator/node_modules/react/cjs/react.development.js:884:10)
          at /Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/act-compat.js:46:25
          at renderRoot (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:189:26)
          at render (/Users/zevia/code/ai/etsy-listing-generator/node_modules/@testing-library/react/dist/pure.js:291:10)
          at Object.<anonymous> (/Users/zevia/code/ai/etsy-listing-generator/src/client/test/ProductUpload.test.tsx:6:9)
          at Promise.then.completed (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:298:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/utils.js:231:10)
          at _callCircusHook (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:281:40)
          at _runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:246:5)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:126:9)
          at _runTestsForDescribeBlock (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:121:9)
          at run (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/run.js:71:3)
          at runAndTransformResultsToJestFormat (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
          at jestAdapter (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
          at runTestInternal (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:367:16)
          at runTest (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/runTest.js:444:34)
          at Object.worker (/Users/zevia/code/ai/etsy-listing-generator/node_modules/jest-runner/build/testWorker.js:106:12)
      152 |         setSystemPrompt(response.systemPrompt || '');
      153 |       } catch (err) {
    > 154 |         console.error('Failed to fetch prompt preview:', err);
          |                 ^
      155 |       }
      156 |     }, [listingRepository])
      157 |   };
      at src/client/hooks/useListingGeneration.ts:154:17
Test Suites: 2 passed, 2 total
Tests:       26 passed, 26 total
Snapshots:   0 total
Time:        2.398 s, estimated 3 s
Ran all test suites matching /src\/client\/test\/ProductUpload.test.tsx|src\/client\/hooks\/useListingGeneration.test.ts/i.
✨  Done in 3.00s.
