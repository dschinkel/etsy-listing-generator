yarn run v1.22.22
$ /Users/zevia/code/ai/etsy-listing-generator/node_modules/.bin/jest src/client/hooks/useListingGeneration.test.ts src/client/hooks/useProductUpload.test.ts src/service/repositories/ListingRepository.test.ts src/service/data/GeminiImageGenerator.test.ts src/service/test/integration/FourLifestyleShots.test.ts src/service/test/integration/GeminiImageGenerator.test.ts src/service/test/integration/GenerateListingImagesError.test.ts
 PASS   service  src/service/repositories/ListingRepository.test.ts
  ‚óè Console
    console.log
      [dotenv@17.2.3] injecting env (1) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
      at _log (node_modules/dotenv/lib/main.js:142:11)
    console.log
      Attempting generation with model: gemini-2.5-flash-image
      at Object.generateImages (src/service/repositories/ListingRepository.ts:48:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: 1,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        themedEnvironment: undefined,
        model: 'gemini-2.5-flash-image',
        hasProductImage: true
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:130:13)
    console.log
      Attempting generation with model: gemini-2.5-flash-image
      at Object.generateImages (src/service/repositories/ListingRepository.ts:48:17)
    console.log
      Generating images with params: {
        lifestyle: 0,
        hero: 0,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        themedEnvironment: undefined,
        model: 'gemini-2.5-flash-image',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:130:13)
    console.log
      Attempting generation with model: gemini-2.5-flash-image
      at Object.generateImages (src/service/repositories/ListingRepository.ts:48:17)
    console.log
      Generating images with params: {
        lifestyle: undefined,
        hero: undefined,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        themedEnvironment: 1,
        model: 'gemini-2.5-flash-image',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:130:13)
 PASS   service  src/service/test/integration/GenerateListingImagesError.test.ts
  ‚óè Console
    console.log
      [dotenv@17.2.3] injecting env (1) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
      at _log (node_modules/dotenv/lib/main.js:142:11)
    console.log
      Incoming request: POST /listings/generate
      at src/service/app.ts:19:11
    console.log
      Attempting generation with model: gemini-2.5-flash-image
      at Object.generateImages (src/service/repositories/ListingRepository.ts:48:17)
    console.log
      Generating images with params: {
        lifestyle: 0,
        hero: 0,
        closeUps: undefined,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        themedEnvironment: undefined,
        model: 'gemini-2.5-flash-image',
        hasProductImage: false
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:130:13)
    console.log
      POST /listings/generate - 200 - 38ms
      at src/service/app.ts:22:11
 PASS   client  src/client/hooks/useProductUpload.test.ts
  ‚óè Console
    console.error
      An update to TestComponent inside a test was not wrapped in act(...).

      When testing, code that causes React state updates should be wrapped into act(...):

      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */

      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
      40 |     if (repository) {
      41 |       repository.getTemplates().then((response: { templates: ContextTemplate[] }) => {
    > 42 |         setTemplates(response.templates || []);
         |         ^
      43 |       });
      44 |       repository.getArchivedUploads().then((response: { images: string[] }) => {
      45 |         setArchivedUploads(response.images || []);
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at src/client/hooks/useProductUpload.ts:42:9
    console.error
      An update to TestComponent inside a test was not wrapped in act(...).

      When testing, code that causes React state updates should be wrapped into act(...):

      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */

      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
      43 |       });
      44 |       repository.getArchivedUploads().then((response: { images: string[] }) => {
    > 45 |         setArchivedUploads(response.images || []);
         |         ^
      46 |       });
      47 |     }
      48 |   }, [repository]);
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at src/client/hooks/useProductUpload.ts:45:9
    console.error
      An update to TestComponent inside a test was not wrapped in act(...).

      When testing, code that causes React state updates should be wrapped into act(...):

      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */

      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
      40 |     if (repository) {
      41 |       repository.getTemplates().then((response: { templates: ContextTemplate[] }) => {
    > 42 |         setTemplates(response.templates || []);
         |         ^
      43 |       });
      44 |       repository.getArchivedUploads().then((response: { images: string[] }) => {
      45 |         setArchivedUploads(response.images || []);
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at src/client/hooks/useProductUpload.ts:42:9
    console.error
      An update to TestComponent inside a test was not wrapped in act(...).

      When testing, code that causes React state updates should be wrapped into act(...):

      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */

      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
      43 |       });
      44 |       repository.getArchivedUploads().then((response: { images: string[] }) => {
    > 45 |         setArchivedUploads(response.images || []);
         |         ^
      46 |       });
      47 |     }
      48 |   }, [repository]);
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at src/client/hooks/useProductUpload.ts:45:9
    console.error
      An update to TestComponent inside a test was not wrapped in act(...).

      When testing, code that causes React state updates should be wrapped into act(...):

      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */

      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
      40 |     if (repository) {
      41 |       repository.getTemplates().then((response: { templates: ContextTemplate[] }) => {
    > 42 |         setTemplates(response.templates || []);
         |         ^
      43 |       });
      44 |       repository.getArchivedUploads().then((response: { images: string[] }) => {
      45 |         setArchivedUploads(response.images || []);
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at src/client/hooks/useProductUpload.ts:42:9
    console.error
      An update to TestComponent inside a test was not wrapped in act(...).

      When testing, code that causes React state updates should be wrapped into act(...):

      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */

      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
      43 |       });
      44 |       repository.getArchivedUploads().then((response: { images: string[] }) => {
    > 45 |         setArchivedUploads(response.images || []);
         |         ^
      46 |       });
      47 |     }
      48 |   }, [repository]);
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at src/client/hooks/useProductUpload.ts:45:9
    console.error
      An update to TestComponent inside a test was not wrapped in act(...).

      When testing, code that causes React state updates should be wrapped into act(...):

      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */

      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
      40 |     if (repository) {
      41 |       repository.getTemplates().then((response: { templates: ContextTemplate[] }) => {
    > 42 |         setTemplates(response.templates || []);
         |         ^
      43 |       });
      44 |       repository.getArchivedUploads().then((response: { images: string[] }) => {
      45 |         setArchivedUploads(response.images || []);
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at src/client/hooks/useProductUpload.ts:42:9
    console.error
      An update to TestComponent inside a test was not wrapped in act(...).

      When testing, code that causes React state updates should be wrapped into act(...):

      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */

      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
      43 |       });
      44 |       repository.getArchivedUploads().then((response: { images: string[] }) => {
    > 45 |         setArchivedUploads(response.images || []);
         |         ^
      46 |       });
      47 |     }
      48 |   }, [repository]);
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at src/client/hooks/useProductUpload.ts:45:9
    console.error
      An update to TestComponent inside a test was not wrapped in act(...).

      When testing, code that causes React state updates should be wrapped into act(...):

      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */

      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
      40 |     if (repository) {
      41 |       repository.getTemplates().then((response: { templates: ContextTemplate[] }) => {
    > 42 |         setTemplates(response.templates || []);
         |         ^
      43 |       });
      44 |       repository.getArchivedUploads().then((response: { images: string[] }) => {
      45 |         setArchivedUploads(response.images || []);
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at src/client/hooks/useProductUpload.ts:42:9
    console.error
      An update to TestComponent inside a test was not wrapped in act(...).

      When testing, code that causes React state updates should be wrapped into act(...):

      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */

      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
      43 |       });
      44 |       repository.getArchivedUploads().then((response: { images: string[] }) => {
    > 45 |         setArchivedUploads(response.images || []);
         |         ^
      46 |       });
      47 |     }
      48 |   }, [repository]);
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at src/client/hooks/useProductUpload.ts:45:9
    console.error
      An update to TestComponent inside a test was not wrapped in act(...).

      When testing, code that causes React state updates should be wrapped into act(...):

      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */

      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
      40 |     if (repository) {
      41 |       repository.getTemplates().then((response: { templates: ContextTemplate[] }) => {
    > 42 |         setTemplates(response.templates || []);
         |         ^
      43 |       });
      44 |       repository.getArchivedUploads().then((response: { images: string[] }) => {
      45 |         setArchivedUploads(response.images || []);
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at src/client/hooks/useProductUpload.ts:42:9
    console.error
      An update to TestComponent inside a test was not wrapped in act(...).

      When testing, code that causes React state updates should be wrapped into act(...):

      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */

      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act
      43 |       });
      44 |       repository.getArchivedUploads().then((response: { images: string[] }) => {
    > 45 |         setArchivedUploads(response.images || []);
         |         ^
      46 |       });
      47 |     }
      48 |   }, [repository]);
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at src/client/hooks/useProductUpload.ts:45:9
 PASS   client  src/client/hooks/useListingGeneration.test.ts
  ‚óè Console
    console.log
      Generation failed for model: gemini-2.5-flash-image Server Error (503): Service Unavailable
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:80:17)
    console.log
      Generation failed for model: gemini-2.5-flash-image Something went wrong
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:80:17)
    console.log
      Generation failed for model: gemini-2.5-flash-image Something went wrong
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:80:17)
    console.log
      Generation failed for model: gemini-2.5-flash-image 503 Service Unavailable
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:80:17)
    console.log
      Generation failed for model: gemini-2.5-flash-image Internal Server Error
      at Object.generateListing (src/client/hooks/useListingGeneration.ts:80:17)
 PASS   service  src/service/test/integration/FourLifestyleShots.test.ts (19.588 s)
  ‚óè Console
    console.log
      [dotenv@17.2.3] injecting env (1) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops
      at _log (node_modules/dotenv/lib/main.js:142:11)
    console.log
      Incoming request: POST /listings/generate
      at src/service/app.ts:19:11
    console.log
      Attempting generation with model: gemini-2.5-flash-image
      at Object.generateImages (src/service/repositories/ListingRepository.ts:48:17)
    console.log
      Generating images with params: {
        lifestyle: 4,
        hero: 0,
        closeUps: 0,
        flatLay: 0,
        macro: 0,
        contextual: 0,
        themedEnvironment: undefined,
        model: 'gemini-2.5-flash-image',
        hasProductImage: true
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:130:13)
    console.log
      POST /listings/generate - 200 - 18175ms
      at src/service/app.ts:22:11
 PASS   service  src/service/test/integration/GeminiImageGenerator.test.ts (22.236 s)
  ‚óè Console
    console.log
      [dotenv@17.2.3] injecting env (1) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
      at _log (node_modules/dotenv/lib/main.js:142:11)
    console.log
      Incoming request: POST /listings/generate
      at src/service/app.ts:19:11
    console.log
      Attempting generation with model: gemini-2.5-flash-image
      at Object.generateImages (src/service/repositories/ListingRepository.ts:48:17)
    console.log
      Generating images with params: {
        lifestyle: 1,
        hero: 0,
        closeUps: 0,
        flatLay: undefined,
        macro: undefined,
        contextual: undefined,
        themedEnvironment: undefined,
        model: 'gemini-2.5-flash-image',
        hasProductImage: true
      }
      at internalGenerateImages (src/service/repositories/ListingRepository.ts:130:13)
    console.log
      POST /listings/generate - 200 - 20751ms
      at src/service/app.ts:22:11
 PASS   service  src/service/data/GeminiImageGenerator.test.ts (45.207 s)
  ‚óè Console
    console.log
      [dotenv@17.2.3] injecting env (1) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
      at _log (node_modules/dotenv/lib/main.js:142:11)
Test Suites: 7 passed, 7 total
Tests:       55 passed, 55 total
Snapshots:   0 total
Time:        46.118 s, estimated 52 s
Ran all test suites matching /src\/client\/hooks\/useListingGeneration.test.ts|src\/client\/hooks\/useProductUpload.test.ts|src\/service\/repositories\/ListingRepository.test.ts|src\/service\/data\/GeminiImageGenerator.test.ts|src\/service\/test\/integration\/FourLifestyleShots.test.ts|src\/service\/test\/integration\/GeminiImageGenerator.test.ts|src\/service\/test\/integration\/GenerateListingImagesError.test.ts/i in 2 projects.
‚ú®  Done in 46.88s.
